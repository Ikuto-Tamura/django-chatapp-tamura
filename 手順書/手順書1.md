# チャットアプリを制作しよう1

### 初期設定前半
課題では、cloneして、それをもとに作業する前提となっていますが、より一般的にwebアプリを開発する場合の手順を解説します。  

part1では、初期設定に関する説明です。  
結構雑談みたいに、細かい話も入れてるけど、最初は太字の部分だけでも抑えるといいと思います！  

ソースコードは、雛形のようなものを貼るが、実際のチャットアプリのサンプルコードを見たほうがわかりやすいと思います。

## 1. 仮想環境を作成し、djangoをinstallする。仮想環境に入る。
ここは他の資料でもいくらでも充実しているので省略します。
余力ができ次第追記します。

## 2. プロジェクトを作成する

`
django-admin startproject (プロジェクト名)
`

というコマンドを実行するとプロジェクトに関するフォルダやファイルが作成されます。
どんなフォルダやファイルが作成されるかは、djangoの[チュートリアル](https://docs.djangoproject.com/ja/5.1/intro/tutorial01/)を参考にしてみてください。

### 💡 コマンドの補足

`
django-admin startproject (プロジェクト名) .
`

でも作成できるし、教材だとそちらが推奨されていますが、これはどこの階層にファイルやフォルダが作成されるかの違いです。  
あまり本質的な違いではなく、プロジェクトに合わせると良いと思います。  
ちなみに、djangoの[チュートリアル](https://docs.djangoproject.com/ja/5.0/intro/tutorial01/)では、前者の.なしのコマンドです。

### ❗プロジェクト名について(重要)

また、**プロジェクト名**ですが、これは開発するアプリの**サービス名**が用いられることが多いです。例えば「line」や「youtube」みたいな感じです。今回のチャットアプリでは、**フロントエンド(FE)** と、**バックエンド(BE)** の両方をdjangoで開発するのですが、
(これを**フルスタック**といいます)、BEだけ担当する場合に「(サービス名)_BE」というプロジェクト名の付け方をすることもあります。

💡教材ではinternというプロジェクト名を用いていますが、これは本来適切ではありません。おそらく諸事情でそうなってるだけです。  
私も、chatapp_pjという名前を用いていますが、これも教材用にアプリフォルダと区別がつきやすいようにしているだけです。

## 3. アプリを作成する

`
python manage.py startapp (アプリ名)
`

でアプリを作成できます。
これでどのようなファイルやフォルダが作成されるかはdjagnoの[チュートリアル](https://docs.djangoproject.com/ja/5.1/intro/tutorial01/)を参考にしてみてください。  
**このコマンドは、manage.pyが直下にある階層で実行してください。**  
他の```python manage.py 〇〇```も同様です。

### ❗アプリ名について(重要)

アプリ名は、**機能に関する名前**をつけます。今回は一つのアプリしか作成しませんが、アカウント管理やチャット機能、通知機能などでアプリを分割することもあります。  
💡私は、chatapp_appという名前を用いていますが、これも今回の教材用にプロジェクトフォルダと区別しやすいようにしているだけなので、真似しないでくださいね。

### ❗INSTALLED_APPSへの追記(重要)

**アプリを作成したら忘れてはいけないのは、settings.pyのINSTALLED_APPSに、アプリ名を追加することです。**

これを忘れてはいけません。絶対に。  

INSTALLED_APPSの追記方法も、大きく2通りあります。  
アプリ名がchatの場合を考えてみますと、
```
①'chat'  

②'chat.apps.ChatConfig'
```
と2通りの書き方があります。

②の方が、カスタマイズ性があるのですが、当分はシンプルに①の書き方で良いと思います。

そして、これはとても重要なことなのですが、**🚨INSTALLED_APPSの記述する順番は大事です。🚨**  
基本的に上から読み込んでいくので、依存関係によってはエラーが起きます。
自作のアプリ名も、デフォルトの記述よりも下、一番下に書いておくと良いです。

## 4. カスタムユーザーモデルを作成する

※ここでは、一般的な手順を述べます。チャットアプリで用いたカスタムユーザーモデルの解説は別の記事に分けます。

### 💡 つまらない前置き/予備知識
djangoでは、デフォルトでユーザーモデルを作成してくれていて、何も設定しないとそれがユーザーモデルとして用いられます。(auth.Userといえばエンジニアには伝わるはず)  

[公式ドキュメント](https://docs.djangoproject.com/ja/5.1/ref/contrib/auth/)
←一応貼っておきますが、最初は読まなくて大丈夫です。理解が深まると何が書かれているかわかるようになると思います。

とはいえ、webアプリごとにユーザーに求められるデータは違うので、デフォルトのユーザーモデルをそのまま使うことはほとんどないでしょう。多くの場合に、**カスタムのユーザーモデルを作成します。**  
なんなら、djagnoの公式ドキュメントはカスタムユーザーモデルを作成することを強く推奨していました。(なぜか、このドキュメントを執筆時にその記述が見つけられてないのですが・・・)

### ❗カスタムユーザモデルを作成するタイミング(重要)

それで、**開発の初期にカスタムユーザーモデルを作成することは重要です。**  
なぜなら、それをせずにmigrationを実行してしまうと、djangoがデフォルトで用意したユーザーモデル(auth.User)に関するデータベース(DB)を作成してしまって、**依存関係とか色々と面倒**になってしまうからです。

### ❗カスタムユーザモデルを作成する方法(重要)

そして、カスタムユーザーモデルを作成する方法は大きく2つあります。  
```
①AbstractUserを継承する方法、  

②AbstractBaseUserを継承する方法
```
です。

これも、②の方がカスタマイズ性が高いのですが、それは同時に書かないといけない量が増えることを意味するので、はじめは**①AbstractUserを継承する方法がおすすめ**です。

💡AbstractUserはfirst_name、last_nameとかいらないフィールドも含まれてしまって、基本的にそれは削除できなくて煩わしいのですが、使わなければ済む話だと思います。
ちなみに、admin画面をカスタマイズして非表示にする方法もあります。

**カスタムユーザーモデルを作成したらsettings.pyにAUTH_USER_MODELを追記しましょう。**
```python
AUTH_USER_MODEL= (アプリ名).(モデル名)
```
です。

## まとめ 
初期設定の前半部分が終了です。
長いのですが、いろんなプロジェクトに共通する設定なので、覚えておくと吉です。
頑張りましょう💪